<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Evil Neuro's German Flashcards</title>

  <style>
    /* ---------- Reset ---------- */
    * { box-sizing: border-box; margin: 0; padding: 0; }

    /* ---------- Page ---------- */
    html,body { height: 100%; }
    body {
  display: flex;
  justify-content: center;
  /* align-items: center; intentionally disabled to allow top scroll space */
  min-height: 100vh;
  background:
    radial-gradient(circle at 20% 80%, rgba(139,0,0,0.12) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(255,0,0,0.07) 0%, transparent 50%),
    linear-gradient(135deg,#0a0a0a 0%,#1a0a0a 100%);
  padding: 20px;
  padding-top: 100px; /* extra scroll space at top */
  padding-bottom: 200px; /* extra space at bottom */
  color: #fff;
  font-family: 'Rajdhani', sans-serif;
  overflow-x: hidden;
  overflow-y: auto;
  position: relative;
}


    /* ---------- Floating background image (optional) ---------- */
    /* Removed broken background image reference */

    /* ---------- Container ---------- */
    .container {
      width: 100%;
      max-width: 900px;
      text-align: center;
      background: rgba(10,0,0,0.86);
      border-radius: 14px;
      padding: 24px 24px 70px;
      min-height: 90vh;
      box-shadow: 0 8px 40px rgba(255,0,0,0.18);
      border: 1px solid rgba(255,0,0,0.12);
      z-index: 10;
      position: relative;
    }

    .header h1 {
      font-family: 'UnifrakturMaguntia', cursive;
      color: #ff0000;
      font-size: 1.8rem;
      text-shadow: 2px 2px 6px rgba(0,0,0,0.7);
      margin-bottom: 6px;
    }
    .header p { color:#ccc; margin-bottom:6px; font-family:'Cinzel Decorative',serif; font-weight:700; }
    .neuro-quote { color:#ff6666; font-style:italic; margin-bottom:10px; }

    /* ---------- Category buttons ---------- */
    .category-filter { display:flex; gap:8px; justify-content:center; flex-wrap:wrap; margin:16px 0; z-index: 11;}
    .category-btn {
      background:#2a0a0a; color:#ccc; border:1px solid #500; padding:6px 10px; border-radius:6px; cursor:pointer;
      font-family:'Cinzel Decorative',serif; font-weight:700;
    }
    .category-btn.active, .category-btn:hover { background:#8B0000; color:#fff; border-color:#ff0000; transform:translateY(-2px); }

    /* ---------- Flashcard ---------- */
    .flashcard {
      width:100%;
      max-width:520px;
      height:260px;
      margin: 10px auto;
      background:#110000;
      border-radius:12px;
      border:2px solid #500;
      box-shadow: 0 12px 30px rgba(0,0,0,0.6);
      perspective:1000px;
      overflow:hidden;
      position: relative;
      z-index: 12;
    }
    .flashcard-inner {
      width:100%; height:100%;
      transition: transform .6s;
      transform-style: preserve-3d;
      position: relative;
    }
    .flashcard.flipped .flashcard-inner { transform: rotateY(180deg); }

    .flashcard-front, .flashcard-back {
      position:absolute; inset:0;
      backface-visibility:hidden;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      padding:18px; text-align:center;
    }
    .flashcard-front { background: linear-gradient(135deg,#1a0a0a,#2a0a0a); color:#fff; }
    .flashcard-back  { background: linear-gradient(135deg,#2a0a0a,#3a0a0a); transform: rotateY(180deg); color:#fff; }

    .word {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.5rem;
      font-weight:700;
      margin-bottom:10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.75);
      word-break:break-word;
      overflow-wrap:break-word;
      max-height: 140px; overflow-y:auto; padding:0 6px;
    }

    .example {
      font-style:italic;
      font-size:.9rem;
      color:#ccc;
      line-height:1.3;
      max-height: 140px; overflow-y:auto;
      padding:0 10px;
      word-break:break-word; overflow-wrap:break-word;
    }

    /* Subtle scrollbar styling for overflow areas */
    .word::-webkit-scrollbar, .example::-webkit-scrollbar { width: 8px; }
    .word::-webkit-scrollbar-thumb, .example::-webkit-scrollbar-thumb { background: rgba(255,0,0,0.25); border-radius: 6px; }
    .word, .example { scrollbar-width: thin; scrollbar-color: rgba(255,0,0,0.35) transparent; }

    .category-tag { margin-top:10px; font-family:'Cinzel Decorative',serif; font-size:.85rem; padding:4px 8px; background:rgba(139,0,0,0.18); border-radius:8px; color:#ffb2b2; }

    /* ---------- Controls ---------- */
    .buttons { display:flex; gap:8px; justify-content:center; margin-top:18px; flex-wrap:wrap; z-index:12; }
    .buttons button {
      background:#2a0a0a; color:#ccc; border:1px solid #500; padding:8px 12px; border-radius:8px; cursor:pointer;
      font-family:'Cinzel Decorative',serif;
    }
    .buttons button:hover { background:#8B0000; color:#fff; transform: translateY(-2px); }

    /* language toggle */
    #lang-toggle {
      background:#2a0a0a; color:#ccc; border:1px solid #500; padding:8px 12px; border-radius:6px; cursor:pointer;
      font-family:'Cinzel Decorative',serif; margin-top:6px;
    }
    #lang-toggle:hover { background:#8B0000; color:#fff; transform: translateY(-2px); }

    .progress { margin-top:12px; color:#ffb2b2; font-family:'Orbitron',sans-serif; }

    /* ---------- Add form ---------- */
    .add-word-form { display:none; margin-top:16px; background:#1a0a0a; padding:12px; border-radius:10px; border:1px solid #500; z-index:12; }
    .add-word-form h2 { color:#ff0000; text-align:center; font-family:'UnifrakturMaguntia',cursive; margin-bottom:10px; }
    .form-group { margin-bottom:8px; }
    .form-group label { display:block; color:#ffb2b2; margin-bottom:6px; font-size:.9rem; }
    .form-group input, .form-group select { width:100%; padding:8px; border-radius:6px; background:#2a0a0a; border:1px solid #500; color:#fff; }

    #add-word-btn { width:100%; padding:10px; margin-top:6px; background:#8B0000; color:#fff; border:none; border-radius:8px; cursor:pointer; }

    /* ---------- Chat message (popups) ---------- */
    #chat-message {
      position: fixed; bottom: 100px; right: 20px;
      background: rgba(139,0,0,0.9); color:#fff; padding:10px 14px; border-radius:8px;
      display:none; z-index: 60; border:1px solid #ff0000; box-shadow:0 0 12px rgba(255,0,0,0.3);
    }

    /* ---------- Floating chaos button ---------- */
    .chaos-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 64px;
      height: 64px;
      border-radius: 50%;
      display:flex; align-items:center; justify-content:center;
      font-size: 1.8rem;
      background: linear-gradient(45deg,#8B0000,#ff4444);
      color:#fff; cursor:pointer; z-index:80;
      box-shadow: 0 0 18px rgba(255,0,0,0.45);
    }
    .chaos-btn:hover { transform: scale(1.06); }

    /* ---------- Data controls ---------- */
    /* Settings container */
    .settings-container {
      position: fixed;
      bottom: 20px;
      left: 20px;
      /* no centering transform; anchored to bottom-left */
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      z-index: 1000;
    }
    .settings-btn {
      background: #444;
      color: #fff;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.2s;
      font-family:'Cinzel Decorative',serif;
      display: none; /* hidden on desktop */
    }
    .settings-btn:hover { background: #666; }

    /* Collapsible controls (repurpose data-controls) */
    .data-controls {
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:10px;
      min-width: 220px;
      opacity: 1;
      max-height: none;
    }
    .data-controls.active { opacity: 1; max-height: none; }
    .data-controls .data-row { display:flex; gap:8px; justify-content:center; align-items:center; }
    .controls-divider {
      width: 100%;
      height: 1px;
      background: linear-gradient(90deg, rgba(255,0,0,0) 0%, rgba(255,0,0,0.35) 50%, rgba(255,0,0,0) 100%);
    }
    .data-controls .data-row { display:flex; gap:8px; justify-content:center; align-items:center; }
    .data-controls button {
      padding: 6px 12px;
      background: #2a0a0a;
      color: #fff;
      border: 1px solid #500;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
      font-family:'Cinzel Decorative',serif;
    }
    .data-controls button:hover { background: #8B0000; }

    /* Larger, centered destroy button above row */
    #destroyBtn {
      font-size: 1.08rem;
      padding: 12px 20px;
      border-width: 3px;
      border-radius: 12px;
      z-index: 76;
    }

    /* ---------- Floating images (ghosts) ---------- */
    
    /* ---------- Evil destroy button + effects ---------- */
    .evil-button {
      background: linear-gradient(180deg,#5a0000 0%, #2a0000 100%);
      color: #fff;
      font-weight: 800;
      letter-spacing: 1px;
      border: 2px solid #000;
      padding: 8px 14px;
      margin: 5px;
      cursor: pointer;
      border-radius: 8px;
      transition: transform .15s ease, box-shadow .2s ease, background .2s ease;
      text-shadow: 0 0 6px rgba(255,0,0,0.55);
      box-shadow: 0 0 0 rgba(255,0,0,0), 0 0 12px rgba(139,0,0,0.35) inset;
      position: relative;
    }
    .evil-button::before {
      content: "â˜ ";
      margin-right: 8px;
      filter: drop-shadow(0 0 4px rgba(255,0,0,0.45));
    }
    .evil-button:hover {
      background: linear-gradient(180deg,#8B0000 0%, #2a0000 100%);
      color: #ff3b3b;
      transform: scale(1.08);
      box-shadow: 0 0 18px rgba(255,0,0,0.45), 0 0 16px rgba(255,0,0,0.25) inset;
    }
    .evil-button:active {
      transform: scale(0.98);
      filter: brightness(1.1);
    }
    .evil-button:focus-visible {
      outline: 2px solid #ff0000;
      outline-offset: 2px;
    }
    .evil-button.pulsing {
      animation: pulseGlow 1.6s ease-in-out infinite;
      box-shadow: 0 0 24px rgba(255,0,0,0.25), 0 0 18px rgba(255,0,0,0.22) inset;
    }
    @keyframes pulseGlow {
      0%   { transform: scale(1); box-shadow: 0 0 10px rgba(255,0,0,0.25), 0 0 8px rgba(255,0,0,0.18) inset; }
      50%  { transform: scale(1.06); box-shadow: 0 0 26px rgba(255,0,0,0.55), 0 0 18px rgba(255,0,0,0.35) inset; }
      100% { transform: scale(1); box-shadow: 0 0 10px rgba(255,0,0,0.25), 0 0 8px rgba(255,0,0,0.18) inset; }
    }
    @keyframes shake {
      0% { transform: translate(2px, 2px); }
      20% { transform: translate(-2px, -2px); }
      40% { transform: translate(2px, -2px); }
      60% { transform: translate(-2px, 2px); }
      80% { transform: translate(2px, 2px); }
      100% { transform: translate(0, 0); }
    }
    .shake { animation: shake 0.1s linear infinite; }
    .lightning-flash {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: white;
      opacity: 0.8;
      z-index: 9999;
      animation: flash 0.2s ease-in-out;
      pointer-events: none;
    }
    @keyframes flash {
      0% { opacity: 0; }
      50% { opacity: 1; }
      100% { opacity: 0; }
    }

    /* Thunder overlay */
    #thunder-flash {
      position: fixed; top:0; left:0; width:100%; height:100%;
      background: white; opacity: 0; pointer-events: none; z-index: 9999;
    }
    #thunder-flash.active { animation: thunderFlash 0.4s ease-in-out; }
    @keyframes thunderFlash {
      0% { opacity: 0; }
      20% { opacity: 0.8; }
      40% { opacity: 0.2; }
      60% { opacity: 0.6; }
      80% { opacity: 0.1; }
      100% { opacity: 0; }
    }

    /* --- Mobile Layout --- */
    @media (max-width: 600px) {
      /* Show Settings button on mobile */
      .settings-btn {
        display: block;
      }
      /* Hide controls by default on mobile; reveal via .active */
      .data-controls {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.4s ease, opacity 0.3s ease;
        opacity: 0;
      }
      .data-controls.active {
        max-height: 240px;
        opacity: 1;
      }
      .controls-divider { margin: 2px 0; }

      /* Flashcard scaling */
      .flashcard {
        width: 95%;
        margin: auto;
      }
      .header h1 { font-size: clamp(20px, 6vw, 28px); }
      .word { font-size: clamp(18px, 6vw, 24px); }
      .example { font-size: clamp(12px, 4.2vw, 16px); }

      /* Navigation buttons resize & wrap */
      .buttons {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 6px;
      }
      .buttons button {
        flex: 1 1 45%;
        font-size: clamp(12px, 4vw, 14px);
        padding: 8px;
      }

      /* Category buttons wrap & resize */
      .category-filter {
        display:flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 6px;
        margin: 10px 0;
      }
      .category-filter .category-btn {
        flex: 1 1 45%;
        font-size: clamp(12px, 4vw, 14px);
        padding: 8px;
      }

      /* slightly reduce paddings for bottom controls on mobile */
      .settings-container { bottom: 16px; left: 16px; gap: 6px; }
      .settings-btn { padding: 8px 12px; }
    }
    .floating-img {
      position: fixed;
      pointer-events: none;
      z-index: 2; /* behind main UI (container z-index 10) */
      will-change: transform, opacity;
      transform-origin: center;
      filter: drop-shadow(0 6px 12px rgba(0,0,0,0.35));
    }
    .floating-img img { display:block; width: 120px; height: auto; max-width: 20vw; opacity: 1; }

    /* multiple patterns for movement */
    @keyframes floaty-path {
      0%   { transform: translate(0px, 0px) rotate(0deg); opacity: 0; }
      8%   { opacity: 0.9; }
      25%  { transform: translate(-60px, -100px) rotate(-8deg); }
      50%  { transform: translate(60px, -220px) rotate(10deg); }
      75%  { transform: translate(-40px, 40px) rotate(-6deg); }
      92%  { opacity: 0.6; }
      100% { transform: translate(0px, -360px) rotate(8deg); opacity: 0; }
    }

    /* small responsive tweaks */
    @media (max-width: 768px) {
      .flashcard { height: 240px; max-width: 88vw; }
      .word { font-size:1.35rem; }
      .floating-img img { width: 100px; }
    }
    @media (max-width: 480px) {
      .container { padding:16px; }
      .flashcard { height: 220px; max-width: 94vw; }
      .floating-img img { width: 86px; }
    }
  </style>
</head>

<body>
  <!-- Floating chaos button -->
  <div class="chaos-btn" id="chaos-btn" title="Chaos Mode">âš¡</div>

  <!-- Settings + Controls (bottom-center) -->
  <div class="settings-container">
    <button id="settings-btn" class="settings-btn">âš™ Settings</button>
    <div class="data-controls" aria-label="data controls">
      <button id="destroyBtn" class="evil-button pulsing">DESTROY</button>
      <div class="controls-divider"></div>
      <div class="data-row">
        <button id="exportBtn">Export</button>
        <input type="file" id="importFile" accept="application/json" style="display:none;" />
        <button id="importBtn">Import</button>
      </div>
      <audio id="thunderSound" src="https://www.myinstants.com/media/sounds/thunder-2.mp3"></audio>
    </div>
  </div>
  <div id="thunder-flash"></div>

  <!-- Container (UI) -->
  <div class="container" role="main">
    <div class="header">
      <div style="display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:6px;">
        <div style="font-size:1.6rem">ðŸ˜ˆ</div>
        <h1>EVIL NEURO'S GERMAN FLASHCARDS</h1>
        <div style="font-size:1.6rem">âš¡</div>
      </div>
      <p style="margin-bottom:6px;">CHAOTIC LANGUAGE LEARNING FOR WORLD DOMINATION</p>
      <div class="neuro-quote" id="neuro-quote">"I drink your tears of confusion! Now learn German!"</div>
    </div>

    <div class="category-filter" aria-hidden="false">
      <button class="category-btn active" data-category="all">ALL</button>
      <button class="category-btn" data-category="everyday">TÃ„GLICHES CHAOS</button>
      <button class="category-btn" data-category="scheme">WELTHERRSCHAFT</button>
      <button class="category-btn" data-category="food">SNACK-VORRÃ„TE</button>
      <button class="category-btn" data-category="weapons">ZERSTÃ–RUNGSWERKZEUGE</button>
    </div>

    <div style="display:flex;justify-content:center;">
      <button id="lang-toggle">LANGUAGE: ENGLISH</button>
    </div>

    <div class="flashcard" id="flashcard" aria-live="polite">
      <div class="flashcard-inner">
        <div class="flashcard-front">
          <div class="word" id="german-word">DER TAG</div>
          <div class="example" id="german-example">EIN GUTER TAG ZUM HARPOONIEREN!</div>
          <div class="category-tag" id="german-category">TÃ„GLICHES CHAOS</div>
        </div>
        <div class="flashcard-back">
          <div class="word" id="english-word">DAY</div>
          <div class="example" id="english-example">A GOOD DAY FOR HARPOONING!</div>
          <div class="category-tag" id="english-category">DAILY CHAOS</div>
        </div>
      </div>
    </div>

    <div class="buttons" role="toolbar" aria-label="controls">
      <button id="prev-btn">ZURÃœCK</button>
      <button id="flip-btn">UMDREHEN</button>
      <button id="next-btn">WEITER</button>
      <button id="random-btn">CHAOS</button>
      <button id="toggle-form">NEUES WORT</button>
    </div>

    <div class="progress" id="progress">1/5</div>

    <div class="add-word-form" id="add-word-form" aria-hidden="true">
      <h2>NEUE VOKABEL</h2>
      <div class="form-group">
        <label for="new-german">DEUTSCHES WORT</label>
        <input id="new-german" type="text" placeholder="z.B. DIE MACHT" />
      </div>
      <div class="form-group">
        <label for="new-english">ENGLISCHES WORT</label>
        <input id="new-english" type="text" placeholder="z.B. POWER" />
      </div>
      <div class="form-group">
        <label for="new-vietnamese">VIETNAMESISCHES WORT (Tiáº¿ng Viá»‡t)</label>
        <input id="new-vietnamese" type="text" placeholder="z.B. NGÃ€Y" />
      </div>
      <div class="form-group">
        <label for="new-german-example">DEUTSCHER SATZ</label>
        <input id="new-german-example" type="text" placeholder="z.B. ICH WILL MEHR MACHT!" />
      </div>
      <div class="form-group">
        <label for="new-english-example">ENGLISCHER SATZ</label>
        <input id="new-english-example" type="text" placeholder="z.B. I WANT MORE POWER!" />
      </div>
      <div class="form-group">
        <label for="new-vietnamese-example">VIETNAMESISCHER SATZ (Tiáº¿ng Viá»‡t)</label>
        <input id="new-vietnamese-example" type="text" placeholder="z.B. Má»˜T NGÃ€Y Tá»T..." />
      </div>
      <div class="form-group">
        <label for="new-category">KATEGORIE</label>
        <select id="new-category">
          <option value="everyday">TÃ„GLICHES CHAOS</option>
          <option value="scheme">WELTHERRSCHAFT</option>
          <option value="food">SNACK-VORRÃ„TE</option>
          <option value="weapons">ZERSTÃ–RUNGSWERKZEUGE</option>
        </select>
      </div>
      <button id="add-word-btn">HINZUFÃœGEN</button>
    </div>
  </div>

  <div id="chat-message" role="status" aria-live="polite">CHAOS UNLEASHED!</div>

  <script>
    /*****************************
     * Flashcards data & logic
     *****************************/
    const categoryMap = {
      everyday: "TÃ„GLICHES CHAOS",
      scheme: "WELTHERRSCHAFT",
      food: "SNACK-VORRÃ„TE",
      weapons: "ZERSTÃ–RUNGSWERKZEUGE"
    };
    const englishCategoryMap = {
      everyday: "DAILY CHAOS",
      scheme: "WORLD DOMINATION",
      food: "SNACK SUPPLIES",
      weapons: "DESTRUCTION TOOLS"
    };
    const vietnameseCategoryMap = {
      everyday: "Há»—n loáº¡n hÃ ng ngÃ y",
      scheme: "Thá»‘ng trá»‹ tháº¿ giá»›i",
      food: "Äá»“ Äƒn váº·t",
      weapons: "CÃ´ng cá»¥ há»§y diá»‡t"
    };
    // alias to match helper code naming
    const categoryMapVi = vietnameseCategoryMap;

    // Default flashcards. We will load saved ones from localStorage if present.
    const defaultFlashcards = [
      {de:"DER TAG", en:"DAY", vi:"NGÃ€Y", deEx:"EIN GUTER TAG ZUM HARPOONIEREN!", enEx:"A GOOD DAY FOR HARPOONING!", viEx:"Má»˜T NGÃ€Y Tá»T Äá»‚ ÄÃ‚M HARPOON!", cat:"everyday"},
      {de:"DIE BANANE", en:"BANANA", vi:"CHUá»I", deEx:"ICH ESSE DIE BANANE FÃœR MACHT.", enEx:"I EAT THE BANANA FOR POWER.", viEx:"TÃ”I Ä‚N CHUá»I Äá»‚ CÃ“ Sá»¨C Máº NH.", cat:"food"},
      {de:"DIE WELTHERRSCHAFT", en:"WORLD DOMINATION", vi:"THá»NG TRá»Š THáº¾ GIá»šI", deEx:"ICH STREBE NACH WELTHERRSCHAFT!", enEx:"I STRIVE FOR WORLD DOMINATION!", viEx:"TÃ”I KHAO KHÃT THá»NG TRá»Š THáº¾ GIá»šI!", cat:"scheme"},
      {de:"DIE HARPUNE", en:"HARPOON", vi:"LAO MÃ“C", deEx:"DIE HARPUNE IST MEIN LIEBSTES WERKZEUG!", enEx:"THE HARPOON IS MY FAVORITE TOOL!", viEx:"LAO MÃ“C LÃ€ CÃ”NG Cá»¤ YÃŠU THÃCH Cá»¦A TÃ”I!", cat:"weapons"},
      {de:"DER COMPUTER", en:"COMPUTER", vi:"MÃY TÃNH", deEx:"MEIN COMPUTER, MEINE REGELN!", enEx:"MY COMPUTER, MY RULES!", viEx:"MÃY TÃNH Cá»¦A TÃ”I, LUáº¬T Cá»¦A TÃ”I!", cat:"scheme"}
    ];

    // Storage helpers
    const STORAGE_KEY = 'flashcards';
    function loadFlashcards() {
      try {
        const saved = JSON.parse(localStorage.getItem(STORAGE_KEY));
        return Array.isArray(saved) && saved.length ? saved : defaultFlashcards;
      } catch (_) {
        return defaultFlashcards;
      }
    }
    function saveFlashcards(list) {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
      } catch (_) {}
    }

    // Initialize flashcards
    let flashcards = loadFlashcards();

    let currentIndex = 0;
    let currentCategory = 'all';

    const germanWord = document.getElementById('german-word');
    const englishWord = document.getElementById('english-word');
    const germanEx = document.getElementById('german-example');
    const englishEx = document.getElementById('english-example');
    const germanCat = document.getElementById('german-category');
    const englishCat = document.getElementById('english-category');
    const flashcard = document.getElementById('flashcard');
    const progress = document.getElementById('progress');
    const neuroQuote = document.getElementById('neuro-quote');

    function getFiltered() {
      return currentCategory === 'all' ? flashcards : flashcards.filter(c => c.cat === currentCategory);
    }

    // â”€â”€ helper to pick translation field with graceful fallback â”€â”€
    function getTranslation(card, fieldBase) {
      if (!card) return '';
      const isExample = fieldBase.endsWith('Ex');
      const suffix = isExample ? 'Ex' : '';
      if (currentLang === 'vi') {
        return card['vi' + suffix] || card['en' + suffix] || card['de' + suffix] || '';
      } else {
        return card['en' + suffix] || card['vi' + suffix] || card['de' + suffix] || '';
      }
    }

    // â”€â”€ replacement updateCard() that respects currentLang â”€â”€
    function updateCard() {
      const filtered = getFiltered();
      if (!filtered.length) {
        germanWord.textContent  = 'KEINE KARTEN';
        englishWord.textContent = currentLang === 'vi' ? 'KHÃ”NG CÃ“ THáºº' : 'NO CARDS';
        germanEx.textContent    = 'EVIL NEURO HAT ALLE KARTEN VERSTECKT!';
        englishEx.textContent   = currentLang === 'vi' ? 'EVIL NEURO ÄÃƒ GIáº¤U Táº¤T Cáº¢ THáºº!' : 'EVIL NEURO HID ALL THE CARDS!';
        germanCat.textContent   = '';
        englishCat.textContent  = '';
        progress.textContent    = '0/0';
        return;
      }

      if (currentIndex >= filtered.length) currentIndex = 0;
      const c = filtered[currentIndex];

      // Left side: always German (source)
      germanWord.textContent = c.de || c.german || '';
      germanEx.textContent   = c.deEx || c.germanEx || '';

      // Right side: language-sensitive translation + example
      if (currentLang === 'vi') {
        englishWord.textContent = c.vi || c.vietnamese || c.en || '';
        englishEx.textContent   = c.viEx || c.vietnameseEx || c.enEx || '';
        englishCat.textContent  = categoryMapVi[c.cat] || englishCategoryMap[c.cat] || '';
      } else {
        englishWord.textContent = c.en || c.english || c.vi || '';
        englishEx.textContent   = c.enEx || c.englishEx || c.viEx || '';
        englishCat.textContent  = englishCategoryMap[c.cat] || '';
      }

      // German category label (left)
      germanCat.textContent = categoryMap[c.cat] || c.cat || '';

      progress.textContent = `${currentIndex+1}/${filtered.length}`;
      flashcard.classList.remove('flipped');

      // occasionally change quote
      if (Math.random() > 0.75) {
        const q = [
          "I drink your tears of confusion!",
          "German is perfect for world domination!",
          "Harpooning is a valid study method!",
          "Soon all will speak German under my rule!"
        ];
        neuroQuote.textContent = `"${q[Math.floor(Math.random()*q.length)]}"`;
      }
    }

    document.getElementById('flip-btn').addEventListener('click', () => flashcard.classList.toggle('flipped'));
    document.getElementById('next-btn').addEventListener('click', () => {
      const f = getFiltered();
      if (!f.length) return;
      currentIndex = (currentIndex+1) % f.length;
      updateCard();
    });
    document.getElementById('prev-btn').addEventListener('click', () => {
      const f = getFiltered();
      if (!f.length) return;
      currentIndex = (currentIndex-1 + f.length) % f.length;
      updateCard();
    });
    document.getElementById('random-btn').addEventListener('click', () => {
      const f = getFiltered();
      if (!f.length) return;
      currentIndex = Math.floor(Math.random() * f.length);
      updateCard();
    });

    document.querySelectorAll('.category-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentCategory = btn.dataset.category;
        currentIndex = 0;
        updateCard();
      });
    });

    document.getElementById('toggle-form').addEventListener('click', () => {
      const form = document.getElementById('add-word-form');
      const isHidden = form.style.display === 'none' || form.style.display === '';
      form.style.display = isHidden ? 'block' : 'none';
      form.setAttribute('aria-hidden', String(!isHidden));
      if (!isHidden) return;
      form.scrollIntoView({ behavior: 'smooth', block: 'center' });
    });

    document.getElementById('add-word-btn').addEventListener('click', () => {
      const newCard = {
        de: (document.getElementById('new-german').value || '').trim(),
        en: (document.getElementById('new-english').value || '').trim(),
        vi: (document.getElementById('new-vietnamese') ? document.getElementById('new-vietnamese').value.trim() : ''),
        deEx: (document.getElementById('new-german-example').value || '').trim(),
        enEx: (document.getElementById('new-english-example').value || '').trim(),
        viEx: (document.getElementById('new-vietnamese-example') ? document.getElementById('new-vietnamese-example').value.trim() : ''),
        cat: document.getElementById('new-category').value
      };
      if (!newCard.de || !newCard.en) {
        showChatMessage('BITTE FÃœLLE DEUTSCH UND ENGLISCH AUS', true);
        return;
      }
      flashcards.push(newCard);
      // Persist to localStorage
      saveFlashcards(flashcards);
      showChatMessage(`"${newCard.de}" HINZUGEFÃœGT!`);
      const addForm = document.getElementById('add-word-form');
      if (addForm) addForm.reset();
      // show the new card
      currentCategory = 'all';
      document.querySelectorAll('.category-btn').forEach(b => b.classList.toggle('active', b.dataset.category === 'all'));
      currentIndex = flashcards.length - 1;
      updateCard();
    });

    function showChatMessage(msg, isError=false, t=2500) {
      const el = document.getElementById('chat-message');
      el.textContent = msg;
      el.style.display = 'block';
      el.style.background = isError ? 'rgba(255,0,0,0.95)' : 'rgba(139,0,0,0.92)';
      clearTimeout(el._hideTimeout);
      el._hideTimeout = setTimeout(() => el.style.display = 'none', t);
    }

    // allow clicking card to flip
    flashcard.addEventListener('click', (e) => {
      // don't flip when clicking form buttons or controls (safety)
      const target = e.target;
      if (target.matches('button, input, select')) return;
      flashcard.classList.toggle('flipped');
    });

    // Keyboard shortcuts: Left/Right to navigate, Space/Enter to flip, R for random
    document.addEventListener('keydown', (e) => {
      const tag = (e.target && e.target.tagName) || '';
      if (tag === 'INPUT' || tag === 'SELECT' || tag === 'TEXTAREA') return;
      if (e.key === 'ArrowRight') { document.getElementById('next-btn').click(); }
      else if (e.key === 'ArrowLeft') { document.getElementById('prev-btn').click(); }
      else if (e.key === ' ' || e.key === 'Enter') { e.preventDefault(); document.getElementById('flip-btn').click(); }
      else if (e.key.toLowerCase() === 'r') { document.getElementById('random-btn').click(); }
    });

    // language toggle
    let currentLang = 'en'; // default English
    const langToggleBtn = document.getElementById('lang-toggle');
    // restore saved language preference
    try {
      const savedLang = localStorage.getItem('flashLang');
      if (savedLang === 'en' || savedLang === 'vi') currentLang = savedLang;
    } catch (_) {}
    langToggleBtn.textContent = 'LANGUAGE: ' + (currentLang === 'en' ? 'ENGLISH' : 'VIETNAMESE (TIáº¾NG VIá»†T)');
    langToggleBtn.addEventListener('click', () => {
      currentLang = currentLang === 'en' ? 'vi' : 'en';
      langToggleBtn.textContent = 'LANGUAGE: ' + (currentLang === 'en' ? 'ENGLISH' : 'VIETNAMESE (TIáº¾NG VIá»†T)');
      try { localStorage.setItem('flashLang', currentLang); } catch (_) {}
      updateCard();
    });

    updateCard();

    // === EXPORT ===
    document.getElementById("exportBtn").addEventListener("click", () => {
      const dataStr = JSON.stringify(flashcards, null, 2);
      const blob = new Blob([dataStr], { type: "application/json" });
      const url = URL.createObjectURL(blob);

      const a = document.createElement("a");
      a.href = url;
      a.download = "flashcards.json";
      a.click();

      URL.revokeObjectURL(url);
    });

    // === IMPORT ===
    const importInput = document.getElementById("importFile");
    document.getElementById("importBtn").addEventListener("click", () => {
      importInput.click(); // triggers hidden file input
    });

    importInput.addEventListener("change", function () {
      const file = this.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const imported = JSON.parse(e.target.result);

          if (Array.isArray(imported)) {
            flashcards = flashcards.concat(imported); // merge
            saveFlashcards(flashcards);
            showChatMessage('âœ… Import erfolgreich!');
            // reflect new data immediately
            currentCategory = 'all';
            document.querySelectorAll('.category-btn').forEach(b => b.classList.toggle('active', b.dataset.category === 'all'));
            currentIndex = flashcards.length - 1;
            updateCard();
          } else {
            showChatMessage('âŒ UngÃ¼ltiges Datei-Format!', true);
          }
        } catch (err) {
          showChatMessage('âŒ Fehler beim Lesen der Datei!', true);
        }
      };
      reader.readAsText(file);
    });

    // Settings toggle
    const settingsBtn = document.getElementById('settings-btn');
    const controlsPanel = document.querySelector('.data-controls');
    settingsBtn.addEventListener('click', () => {
      controlsPanel.classList.toggle('active');
    });

    // === DESTROY: thunder, shake, flash, nuke storage ===
    const destroyBtn = document.getElementById('destroyBtn');
    const thunderSound = document.getElementById('thunderSound');
    const thunderFlash = document.getElementById('thunder-flash');
    document.getElementById('destroyBtn').addEventListener('click', () => {
      // Pre-confirm dramatic effects
      try { thunderSound.currentTime = 0; thunderSound.play(); } catch (_) {}
      thunderFlash.classList.add('active');
      setTimeout(() => thunderFlash.classList.remove('active'), 500);
      document.body.classList.add('shake');
      setTimeout(() => document.body.classList.remove('shake'), 400);
      showChatMessage('âš¡ EVIL DESTRUCTION UNLEASHED âš¡');

      if (confirm('âš¡ Are you sure you want to DESTROY all your data? âš¡')) {
        destroyBtn.classList.remove('pulsing');

        // Bigger flash + shake before nuke
        document.body.classList.add('shake');
        thunderFlash.classList.add('active');
        setTimeout(() => {
          thunderFlash.classList.remove('active');
          document.body.classList.remove('shake');
          try { localStorage.clear(); } catch (_) {}
          alert('ðŸ’€ All data has been DESTROYED in a storm of chaos! ðŸ’€');
          location.reload();
        }, 1500);
      }
    });

    /*****************************
     * Floating image spawner
     * Put your PNG files in the same folder as this HTML,
     * OR adjust the paths in the images array below.
     *****************************/
    const images = [
      "Evil_angry_blushing.png",
      "Evil_angry_glare.png",
      "Evil_blushing.png",
      "Evil_blushing_2.png",
      "Evil_cat_ears_arms_up_closed_eyes.png",
      "Evil_cat_ears_ducky.png",
      "Evil_cat_ears_looking_up.png",
      "Evil_catears_annoyed.png",
      "Evil_catears_arms_up.png",
      "Evil_catears_heart_eyes.png",
      "Evil_catears_questionmark_2.png",
      "Evil_catears_questionmark.png",
      "Evil_catears_questionmark_looking_up.png",
      "Evil_catears_scared.png",
      "Evil_crying.png",
      "Evil_crying_closed_eyes.png",
      "Evil_default.png",
      "Evil_froghat.png",
      "Evil_froghat_questionmark.png",
      "Evil_glare.png",
      "Evil_hands_up.png",
      "Evil_hands_up_2.png",
      "Evil_hands_up_closed_eyes.png",
      "Evil_heart_eyes.png",
      "Evil_hearteyes.png",
      "Evil_hearth_eyes_open_mouth.png",
      "Evil_judging.png",
      "Evil_leaning.png",
      "Evil_looking.png",
      "Evil_looking_right.png",
      "Evil_looking_up.png",
      "Evil_looking_up_questionmark.png",
      "Evil_questionmark.png",
      "Evil_questionmark2.png",
      "Evil_questionmark3.png",
      "Evil_questionmark_looking_side.png",
      "Evil_sad.png",
      "Evil_sad_1.png"
    ];

    // spawn a modest number randomly placed (keeps page lighter)
    function spawnFloatingImages(num = images.length) {
      // remove previous floating images (if any)
      document.querySelectorAll('.floating-img--generated').forEach(n => n.remove());

      // choose a shuffled selection to spawn
      const pool = images.slice();
      // shuffle
      for (let i = pool.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [pool[i], pool[j]] = [pool[j], pool[i]];
      }

      // spawn up to 'num' (cap at pool.length)
      const count = Math.min(num, pool.length);
      for (let i = 0; i < count; i++) {
        const file = pool[i];
        const wrapper = document.createElement('div');
        wrapper.className = 'floating-img floating-img--generated';

        // random screen start (so they look chaotic)
        const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
        const vh = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0);

        // pick random positions (allow slightly outside edges)
        const left = Math.random() * 100; // percent
        const top = 30 + Math.random() * 70; // start lower half (30vh-100vh)
        wrapper.style.left = left + 'vw';
        wrapper.style.top = top + 'vh';

        // random opacity and scale
        const alpha = 0.12 + Math.random() * 0.28; // 0.12 - 0.4
        const scale = 0.7 + Math.random() * 0.8; // 0.7 - 1.5
        wrapper.style.opacity = alpha;
        wrapper.style.transform = `scale(${scale})`;

        // random animation duration and delay
        const duration = 18 + Math.random() * 36; // 18s - 54s
        const delay = -Math.random() * duration; // negative so some start mid-animation
        wrapper.style.animation = `floaty-path ${duration}s linear infinite`;
        wrapper.style.animationDelay = `${delay}s`;

        // random rotation origin for variety
        wrapper.style.willChange = 'transform,opacity';

        const img = document.createElement('img');
        img.src = file; // ensure file path is correct (same folder recommended)
        img.alt = file;
        img.style.maxWidth = '18vw';
        img.onerror = () => {
          // failed to load image (silent fallback)
          wrapper.remove();
        };

        wrapper.appendChild(img);
        document.body.appendChild(wrapper);
      }
    }

    // initial spawn (you can choose number)
    spawnFloatingImages(Math.min(images.length, 16));

    // clicking chaos button spawns a burst and randomizes flashcard
    document.getElementById('chaos-btn').addEventListener('click', () => {
      spawnFloatingImages(18); // spawn more ghosts
      // small screen flash
      document.body.animate(
        [{ filter: 'brightness(1.0)' }, { filter: 'brightness(1.35)' }, { filter: 'brightness(1.0)' }],
        { duration: 360, easing: 'ease-out' }
      );
      // choose a random flashcard (chaos)
      const filtered = getFiltered();
      if (filtered.length) {
        currentIndex = Math.floor(Math.random() * filtered.length);
        updateCard();
      }
      showChatMessage('âš¡ CHAOS MODE ENGAGED âš¡', false, 2200);
    });

    // spawn new ghosts occasionally so it never feels static
    setInterval(() => {
      // randomly respawn a few to keep it lively
      if (Math.random() > 0.6) spawnFloatingImages(8 + Math.floor(Math.random()*10));
    }, 15000);

    // re-spawn on resize so positions scale nicely
    window.addEventListener('resize', () => {
      spawnFloatingImages(Math.min(images.length, 16));
    });

  </script>
</body>
</html>
